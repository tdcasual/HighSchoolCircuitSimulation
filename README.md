# 电学模拟工具

一个基于Web的交互式电路仿真工具，支持拖拽式电路设计、实时仿真计算和电路图自动转换。

## 功能特性

### 🎨 可视化电路设计
- **拖拽式操作**：通过鼠标拖拽放置元器件
- **智能布线**：支持正交自动布线、导线分段与端点吸附
- **对齐辅助**：拖动元器件时显示对齐参考线
- **平滑交互**：10秒自动隐藏导线端点手柄，保持界面整洁

### ⚡ 实时电路仿真
- **改进节点分析法(MNA)**：精确求解电路状态
- **支持元器件类型**：
  - 电源（含内阻）
  - 定值电阻
  - 滑动变阻器（三端可调）
  - 电容
  - 灯泡
  - 开关
  - 电流表
  - 电压表
  - 电动机

### 📊 实时数据显示
- 电压、电流、功率实时更新
- 断开元器件自动显示为0
- 电容充放电动态模拟

### 💾 电路导入导出
- **JSON格式**：完整保存电路结构
- **AI辅助转换**：使用 `电路图转JSON-Prompt.md` 配合LLM将手绘电路图转换为JSON

## 快速开始

### 在线使用
直接打开 `index.html` 文件即可在浏览器中运行，无需安装任何依赖。

### P0 基线回归（20 个标准电路）
用于后续重构时防止数值漂移：

```bash
npm run baseline:p0:update   # 首次或有意更新基线
npm run baseline:p0          # 日常对比校验
```

输出文件：
- 当前快照：`output/baselines/p0-electrical-current.json`
- 差异报告：`output/baselines/p0-electrical-diff.md`
- 仓库基线：`scripts/benchmark/baselines/p0-electrical-baseline.json`

### 基本操作

#### 添加元器件
1. 点击左侧工具栏的元器件按钮
2. 在画布上点击放置元器件
3. 双击元器件可编辑参数

#### 连接导线
1. `Shift + 点击` 空白画布开始布线（也支持工具栏选择导线后点击起点）
2. 点击目标端子、导线端点或网格点完成连接
3. 按 `Esc` 键取消布线

#### 编辑导线
1. 拖动导线可整体平移（按网格移动）
2. 拖动导线端点默认仅移动该端点（按住 `Shift` 可拖动整个节点）
3. `Ctrl/Cmd + 点击` 导线可在点击处分割为两段独立导线（或右键菜单分割）

#### 调节滑动变阻器
1. 选中滑动变阻器
2. 拖动滑块改变阻值
3. 观察电路参数实时变化

#### 导入电路
1. 点击"导入电路"按钮
2. 粘贴JSON格式的电路数据
3. 点击确认加载电路

## 项目结构

```
电学模拟工具/
├── index.html                    # 主页面
├── README.md                     # 项目说明
├── 电路图转JSON-Prompt.md        # AI转换提示词
├── src/
│   ├── engine/
│   │   ├── Circuit.js           # 电路引擎（MNA求解器）
│   │   └── components/          # 元器件模型
│   │       ├── PowerSource.js
│   │       ├── Resistor.js
│   │       ├── Rheostat.js
│   │       ├── Capacitor.js
│   │       ├── Bulb.js
│   │       ├── Switch.js
│   │       ├── Ammeter.js
│   │       ├── Voltmeter.js
│   │       └── Motor.js
│   └── ui/
│       ├── Canvas.js            # 画布渲染
│       ├── Interaction.js       # 交互逻辑
│       ├── Toolbar.js           # 工具栏
│       └── PropertyPanel.js     # 属性面板
└── assets/                      # 静态资源
```

## 电路图转JSON

使用 `电路图转JSON-Prompt.md` 文件配合ChatGPT/Claude等LLM，可以将手绘电路图或教材电路图快速转换为JSON格式。

### 使用步骤
1. 打开 `电路图转JSON-Prompt.md`
2. 复制全部内容作为系统提示词
3. 上传电路图图片
4. LLM将输出标准JSON格式
5. 在工具中导入JSON

### 转换示例
原始电路图 → AI识别 → JSON输出 → 工具导入 → 可编辑电路

### 导线 JSON 规范（v2）
- 导线统一使用端点坐标模型：`{ id, a:{x,y}, b:{x,y}, aRef?, bRef? }`
- `aRef/bRef` 为可选端子绑定：`{ componentId, terminalIndex }`
- 运行时与导出仅使用 v2 模型，不再生成 `start/end/controlPoints` 结构
- 导入仍兼容旧格式（`start/end`、`startComponentId/endComponentId`、`controlPoints`），会自动迁移为 v2 分段导线

## 技术特点

### 数值计算
- 使用改进节点分析法(Modified Nodal Analysis)
- Norton等效电路模型
- 欧拉法求解微分方程（电容充放电）

### 交互优化
- 5像素拖动阈值区分点击/拖动
- 智能端子/导线端点吸附（避免连线跳动）
- 导线端点手柄自动隐藏机制
- 实时对齐参考线

### 可扩展性
- 模块化元器件系统
- 统一的端子接口
- 易于添加新元器件类型

## 已知限制

- 不支持交流电路分析
- 不支持非线性元器件（如二极管）
- 电容仅支持简单充放电模拟
- 最大节点数建议不超过100

## 开发计划

- [ ] 支持电路原理图自动布局
- [ ] 添加示波器功能
- [ ] 支持电路动画回放
- [ ] 导出为PNG/SVG图片
- [ ] 更多元器件类型（变压器、继电器等）

## 许可证

MIT License

## 贡献

欢迎提交Issue和Pull Request！

---

**提示**：本工具主要用于教学和学习，计算结果仅供参考。
