# 改进闭环流程（SOP）

目标：让每次优化都可追踪、可验证、可持续复用。

## Step 1. 问题登记

在 `docs/audits/...` 新建记录，至少包含：

1. 现象描述（用户视角）
2. 影响范围（设备/布局/模块）
3. 预期行为
4. 严重级别（P0-P3）

## Step 2. 复现与证据采集

要求先复现再修复，禁止“先改再猜”。

1. 明确复现条件（如 `layout-mode-phone`、触控设备、首开状态）
2. 记录关键证据（日志、DOM 状态、截图、E2E 报错）
3. 在文档中写出稳定复现路径

## Step 3. 根因定位

输出最小根因说明：

1. 触发链路（事件 -> 状态 -> UI）
2. 直接根因（例如遮罩层拦截、状态未关闭、手势冲突）
3. 受影响代码位置（文件 + 函数）

## Step 4. 方案设计（小步可回归）

1. 先写失败测试（RED）
2. 只做必要最小改动（GREEN）
3. 必要时再做结构整理（REFACTOR）

## Step 5. 验证与验收

每次修复至少执行：

1. 目标单测（新增/修改的测试文件）
2. 相关模块回归（受影响控制器、交互链路）
3. 移动端响应式 E2E：`npm run test:e2e:responsive`
4. 代码质量检查：`npm run lint`

## Step 6. 文档同步

修复完成后同步更新：

1. `docs/audits/...`：补齐“根因/改动/验证结果”
2. `docs/releases/...`：若影响发布门禁，补充 QA 证据
3. `README.md` 或 `docs/README.md`：若流程/入口变化，更新索引

## Step 7. 关闭标准

仅当以下条件同时满足时，问题才可标记完成：

1. 用户可感知问题已不可复现
2. 自动化测试已覆盖关键回归路径
3. 文档可让他人在不了解上下文的情况下独立复盘
