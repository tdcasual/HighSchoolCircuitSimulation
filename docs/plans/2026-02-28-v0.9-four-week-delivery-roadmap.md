# V0.9 Four-Week Delivery Roadmap Implementation Plan

> **For Claude:** REQUIRED SUB-SKILL: Use superpowers:executing-plans to implement this plan task-by-task.

**Goal:** Deliver a classroom-ready v0.9 release that closes the largest maturity gaps versus commercial mobile circuit simulators by improving solver reliability, mobile editing usability, observation workflow efficiency, and release quality gates.

**Architecture:** Execute in four weekly vertical slices with explicit acceptance gates: (1) reliability hardening at solver/runtime boundary, (2) mobile interaction loop optimization, (3) observation v2.5 productivity layer, and (4) release stabilization + curriculum packaging. Keep all work behind regression baselines (unit + E2E + CI) to prevent backsliding.

**Tech Stack:** Vanilla ES modules, Canvas/SVG rendering, Vitest, Playwright E2E, GitHub Actions CI.

**Scope Window:** Monday **2026-03-02** to Sunday **2026-03-29** (Asia/Shanghai).

**Skills Required During Execution:** @superpowers:test-driven-development, @superpowers:systematic-debugging, @superpowers:verification-before-completion

---

## Delivery Rules (Applies Every Day)

1. Start each task with a failing test or failing scripted check.
2. Land only minimal code to pass the target check.
3. Run focused tests after each task, then daily aggregate suite.
4. Keep commits small and scoped (1 task = 1 commit when possible).
5. Do not merge to `main` unless daily gate passes.

---

## Week 1: Solver Reliability & Runtime Diagnostics (2026-03-02 ~ 2026-03-08)

### Weekly Outcome
- Non-convergent/invalid circuits fail gracefully with actionable diagnostics.
- High-frequency failure classes are covered by regression tests.

### Day-by-Day Plan

#### Day 1 (Mon 2026-03-02) - Failure Taxonomy & Baseline Capture
- Define canonical failure categories: `SHORT_CIRCUIT`, `FLOATING_SUBCIRCUIT`, `SINGULAR_MATRIX`, `CONFLICTING_SOURCES`, `INVALID_PARAMS`.
- Add failing tests for category mapping from solver/runtime results.
- Create baseline markdown report for current failure behavior.
- Verification:
  - `npm test -- tests/solver.commonCases.spec.js tests/wireShortCircuit.spec.js`

#### Day 2 (Tue 2026-03-03) - Structured Runtime Error Payload
- Introduce normalized runtime diagnostic payload (`code`, `summary`, `hints`, `componentIds`, `wireIds`).
- Pipe payload into app-level status channel without breaking existing UI.
- Add tests for payload shape and backward compatibility.
- Verification:
  - `npm test -- tests/interaction.orchestrator.spec.js tests/circuit.solverPreparation.spec.js`

#### Day 3 (Wed 2026-03-04) - Actionable User Hints
- Add deterministic hint strategies per failure code.
- Ensure hints use direct repair language (e.g., "检查电源两端是否被导线直接短接").
- Add tests for hint text selection and priority ordering.
- Verification:
  - `npm test -- tests/solver.commonMistakes.spec.js tests/interaction.measurementReadoutController.spec.js`

#### Day 4 (Thu 2026-03-05) - Stress Cases & Guard Rails
- Add stress regression set for extreme values (very small/large R/C, mixed ideal/non-ideal sources).
- Ensure no runtime crash; must return invalid result + diagnostics.
- Verification:
  - `npm test -- tests/solver.inputHardening.spec.js tests/solver.dynamicIntegration.spec.js`

#### Day 5 (Fri 2026-03-06) - Reliability Gate & CI Hook
- Add reliability-focused test aggregate script.
- Update CI workflow to run reliability aggregate in PR checks.
- Verification:
  - `npm test -- tests/ci.workflow.spec.js`
  - `npm run check`

#### Day 6 (Sat 2026-03-07) - Buffer / Bugfix Day
- Only fix issues discovered during Week 1 checks.
- No new feature scope.

#### Day 7 (Sun 2026-03-08) - Weekly Review
- Publish week summary with:
  - failure category pass rate
  - top unresolved risks
  - carry-over tasks

### Week 1 Exit Criteria
- Reliability regression suite pass rate = 100%.
- Invalid circuits never crash UI thread.
- Every invalid solve exposes at least one actionable hint.

---

## Week 2: Mobile Editing Efficiency (2026-03-09 ~ 2026-03-15)

### Weekly Outcome
- Complete "build-run-measure" loop on phone with fewer taps and lower mis-touch rate.

### Day-by-Day Plan

#### Day 8 (Mon 2026-03-09) - Touch Flow Benchmark
- Record baseline metrics for three canonical tasks (series, parallel, probe-measurement).
- Add scripted tap-count collector for repeatable benchmark.
- Verification:
  - `node scripts/e2e/responsive-touch-regression.mjs`

#### Day 9 (Tue 2026-03-10) - Wire Endpoint Snap Tolerance
- Improve endpoint snapping tolerance and visual affordance for touch drag.
- Add failing+passing E2E assertion for missed-snap scenarios.
- Verification:
  - `npm test -- tests/interaction.wireSegmentSnap.spec.js`
  - `npm run test:e2e:wire`

#### Day 10 (Wed 2026-03-11) - Mis-touch Prevention Layer
- Add pointer-intent threshold before destructive actions (split/delete/close).
- Add tests for accidental tap cancellation.
- Verification:
  - `npm test -- tests/interaction.pointerSessionManager.spec.js tests/interaction.contextMenuController.spec.js`

#### Day 11 (Thu 2026-03-12) - One-Handed Quick Actions
- Rebalance quick-action bar ordering for high-frequency mobile actions.
- Ensure action state is consistent with current selection mode.
- Verification:
  - `npm test -- tests/quickActionBarController.spec.js tests/topActionMenuController.spec.js`

#### Day 12 (Fri 2026-03-13) - Mobile E2E Expansion
- Extend `responsive-touch-regression` coverage to include edit + measure workflow.
- Capture failure screenshots and diff notes.
- Verification:
  - `npm run test:e2e:responsive`

#### Day 13 (Sat 2026-03-14) - Buffer / Bugfix Day
- Fix mobile-only regressions from expanded E2E checks.

#### Day 14 (Sun 2026-03-15) - Weekly Review
- Publish metric delta: tap count, task completion time, mis-touch rate.

### Week 2 Exit Criteria
- Average tap count reduction >= 20% (vs Day 8 baseline).
- Mobile E2E suite green.
- No critical mobile interaction regression in desktop mode.

---

## Week 3: Observation v2.5 Productivity Layer (2026-03-16 ~ 2026-03-22)

### Weekly Outcome
- Observation becomes reusable and presentation-ready (templates, linked cursor, auto-range, export).

### Day-by-Day Plan

#### Day 15 (Mon 2026-03-16) - Observation Template Schema
- Design template JSON schema (`name`, `plots`, `ui`, `bindings`).
- Add normalization and migration tests.
- Verification:
  - `npm test -- tests/observationState.spec.js`

#### Day 16 (Tue 2026-03-17) - Template Save/Load UI
- Add UI actions for saving/loading template presets.
- Ensure backward compatibility with existing observation state.
- Verification:
  - `npm test -- tests/observationPanel.uxMode.spec.js tests/observationPanel.quickBind.spec.js`

#### Day 17 (Wed 2026-03-18) - Linked Cursor Across Plots
- Implement synchronized crosshair readout across active plot cards.
- Add tests for linked interaction behavior.
- Verification:
  - `npm test -- tests/observationChartInteraction.spec.js tests/observationPlotCardController.spec.js`

#### Day 18 (Thu 2026-03-19) - Auto-Range Strategy Upgrade
- Add smarter auto-range stabilization (anti-jitter windows + hysteresis).
- Add regression tests for noisy/step signals.
- Verification:
  - `npm test -- tests/observationMath.spec.js tests/observationPanel.renderLifecycle.spec.js`

#### Day 19 (Fri 2026-03-20) - Observation Export
- Add PNG export for plot area and current readout metadata.
- Add smoke E2E check for export trigger.
- Verification:
  - `node scripts/e2e/observation-touch-regression.mjs`

#### Day 20 (Sat 2026-03-21) - Buffer / Bugfix Day
- Resolve template compatibility and linked-cursor regressions.

#### Day 21 (Sun 2026-03-22) - Weekly Review
- Publish observation workflow benchmark: "open panel -> apply preset/template -> show chart" median time.

### Week 3 Exit Criteria
- Template round-trip success rate = 100% on test fixtures.
- Multi-plot linked cursor works without frame drops in target device class.
- Observation export produces valid image artifacts.

---

## Week 4: Release Stabilization & Classroom Packaging (2026-03-23 ~ 2026-03-29)

### Weekly Outcome
- Ship-ready v0.9 candidate with guided classroom scenarios and release checks.

### Day-by-Day Plan

#### Day 22 (Mon 2026-03-23) - Scenario Pack Definition
- Finalize 6 classroom presets: series, parallel, divider, RC charge/discharge, motor feedback, probe measurement.
- Add fixture validation tests.
- Verification:
  - `npm test -- tests/circuit.io.spec.js tests/circuitSchema.spec.js`

#### Day 23 (Tue 2026-03-24) - First-Run Guidance
- Implement lightweight first-run guide overlay with skip/remember state.
- Ensure no disruption for returning users.
- Verification:
  - `npm test -- tests/interaction.uiStateController.spec.js`

#### Day 24 (Wed 2026-03-25) - Error-to-Lesson Mapping
- Connect top failure diagnostics to learning prompts (what happened + why + how to fix).
- Add copy tests and snapshot checks.
- Verification:
  - `npm test -- tests/knowledgeResourceProvider.spec.js tests/circuitAIAgent.spec.js`

#### Day 25 (Thu 2026-03-26) - Release Candidate Hardening
- Run full `check:full`; fix blocking regressions only.
- Freeze feature scope at end of day.
- Verification:
  - `npm run check:full`

#### Day 26 (Fri 2026-03-27) - Docs, Changelog, QA Signoff
- Update README release notes + migration notes.
- Produce QA checklist and known issues table.
- Verification:
  - `npm run check`

#### Day 27 (Sat 2026-03-28) - Buffer / Hotfix Day
- Only blocker fixes accepted.

#### Day 28 (Sun 2026-03-29) - v0.9 Release Readiness Review
- Final go/no-go against all metrics.
- If go: tag release candidate and archive checklist artifacts.

### Week 4 Exit Criteria
- `npm run check:full` passes on release candidate.
- All 6 scenario presets load and run successfully.
- Release note + known issues + rollback plan complete.

---

## Global Metrics Dashboard (Track Weekly)

- Reliability:
  - invalid-circuit crash count (target: 0)
  - diagnostic hint coverage (target: 100%)
- Mobile UX:
  - task median tap count (target: -20% vs baseline)
  - task completion success (target: >= 95%)
- Observation:
  - preset/template time-to-chart (target: <= 3s median)
  - interaction regressions (target: 0 blockers)
- Quality:
  - unit/E2E pass rate (target: 100% on gated suites)
  - CI red builds per week (target: <= 1)

---

## Risk Register & Mitigation

1. **Risk:** Solver reliability changes destabilize existing circuits.
- Mitigation: lock baseline tests and run comparison gates daily.

2. **Risk:** Mobile UX tweaks cause desktop regressions.
- Mitigation: keep mode-conditional guards + dual-mode E2E coverage.

3. **Risk:** Observation features bloat performance.
- Mitigation: enforce render lifecycle tests + frame-time smoke checks.

4. **Risk:** Scope creep in Week 4 blocks release.
- Mitigation: hard feature freeze on **2026-03-26**.

---

## Handoff Checklist for Execution Session

1. Create execution branch from `main` (prefix `codex/`).
2. Execute this plan day-by-day with TDD discipline.
3. At each week end: provide metrics report + risk status.
4. Before release recommendation: attach verification command outputs.
