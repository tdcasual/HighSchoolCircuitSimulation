# AGENTS.md - 电路模拟器代理文档

## 引言

在高中电路模拟器中，"代理"（Agents）指的是电路中的元器件实体。这些代理是模拟的核心元素，每个代理代表一个真实的电气元件，具有特定的电气特性、行为和交互方式。通过修改节点分析法（MNA），这些代理共同构建和求解电路方程，实现实时电路仿真。

代理具有以下共同特征：
- **状态**：电压、电流、功率等动态值
- **属性**：定义电气特性的参数（如电阻值、电压等）
- **行为**：通过MNA印记（stamp）贡献电路方程
- **交互**：通过导线连接形成电路网络

## 代理概览

模拟器支持以下代理类型：

| 类型 | 中文名称 | 终端数 | 主要作用 |
|------|----------|--------|----------|
| PowerSource | 电源 | 2 | 提供电动势和内阻 |
| Resistor | 定值电阻 | 2 | 提供固定电阻 |
| Rheostat | 滑动变阻器 | 3 | 可变电阻，模拟滑动触点 |
| Bulb | 灯泡 | 2 | 非线性电阻，模拟灯丝特性 |
| Capacitor | 电容 | 2 | 储能元件，处理瞬态响应 |
| Motor | 电动机 | 2 | 动态元件，包含反电动势 |
| Switch | 开关 | 2 | 控制电路通断 |
| Ammeter | 电流表 | 2 | 测量电流（理想或有内阻） |
| Voltmeter | 电压表 | 2 | 测量电压（理想或有内阻） |

## 详细代理档案

### PowerSource (电源)

**作用**：提供恒定的电动势，模拟电池或电源供应。

**属性**：
- `voltage`: 电动势 (V)，默认 12V
- `internalResistance`: 内阻 (Ω)，默认 0.5Ω

**行为/方程**：
- 若内阻 > 0：使用诺顿等效（电流源 I = E/r 并联电阻 r）
- 若内阻 ≈ 0：理想电压源，强制两端电压差为 E
- 负极通常作为参考地（节点0）

**终端**：2个（正极、负极）

**可视化**：长方形符号，中间两条平行线表示电池

**交互**：作为电路的能量来源，其他代理通过连接获取电压

### Resistor (定值电阻)

**作用**：提供固定电阻，遵循欧姆定律。

**属性**：
- `resistance`: 电阻值 (Ω)，默认 100Ω

**行为/方程**：
- 贡献电导 G = 1/R 到MNA矩阵
- 电流 I = V/R（通过求解器计算）

**终端**：2个

**可视化**：矩形符号

**交互**：消耗功率 P = I²R，影响电路分压

### Rheostat (滑动变阻器)

**作用**：可变电阻，模拟滑动触点位置变化。

**属性**：
- `minResistance`: 最小电阻 (Ω)，默认 0Ω
- `maxResistance`: 最大电阻 (Ω)，默认 100Ω
- `position`: 滑块位置 (0-1)，默认 0.5
- `connectionMode`: 连接模式 ('none', 'left-slider', 'right-slider', 'left-right', 'all')

**行为/方程**：
- 内部模型：左端 -- R1 -- 滑块 -- R2 -- 右端
- R1 = maxR × position, R2 = maxR × (1-position)
- 根据连接模式选择性添加电阻印记

**终端**：3个（左端、右端、滑块）

**可视化**：矩形带箭头指示滑块位置

**交互**：通过改变position动态调节电路电阻

### Bulb (灯泡)

**作用**：非线性电阻元件，模拟灯丝的温度特性。

**属性**：
- `resistance`: 灯丝电阻 (Ω)，默认 50Ω
- `ratedPower`: 额定功率 (W)，默认 5W

**行为/方程**：
- 目前作为普通电阻处理（未来可扩展为非线性）
- 电导 G = 1/R

**终端**：2个

**可视化**：圆形符号，内部交叉线

**交互**：功率超过额定值时可视化发光效果

### Capacitor (电容)

**作用**：储能元件，处理电路的瞬态响应。

**属性**：
- `capacitance`: 电容值 (F)，默认 0.001F

**行为/方程**：
- 使用后向欧拉法：等效电阻 Req = dt/C
- 等效电流源 Ieq = C × V_prev / dt
- 积分电压变化：V(t+1) = V(t) + (I × dt)/C

**终端**：2个

**可视化**：两条平行线

**交互**：充电/放电过程影响电路动态响应

### Motor (电动机)

**作用**：动态元件，包含反电动势和机械特性。

**属性**：
- `resistance`: 电枢电阻 (Ω)，默认 5Ω
- `torqueConstant`: 转矩常数 (N·m/A)，默认 0.1
- `emfConstant`: 反电动势常数 (V·s/rad)，默认 0.1
- `inertia`: 转动惯量 (kg·m²)，默认 0.01
- `loadTorque`: 负载转矩 (N·m)，默认 0.01

**行为/方程**：
- 电阻印记 + 反电动势电压源
- 反电动势 E = k × ω（ω通过积分计算）
- 转矩 T = k × I - T_load
- 角加速度 α = T / J

**终端**：2个

**可视化**：圆形符号，内部"M"

**交互**：电流驱动转矩，反电动势反馈到电路

### Switch (开关)

**作用**：控制电路通断的开关元件。

**属性**：
- `closed`: 开关状态，true=闭合，false=断开，默认 false

**行为/方程**：
- 闭合：极小电阻 (1e-9Ω)
- 断开：极大电阻 (1e12Ω)

**终端**：2个

**可视化**：开关符号，闭合时连接线

**交互**：改变状态时重建电路拓扑

### Ammeter (电流表)

**作用**：测量通过的电流。

**属性**：
- `resistance`: 内阻 (Ω)，默认 0Ω（理想）
- `range`: 量程 (A)，默认 3A

**行为/方程**：
- 若resistance > 0：普通电阻
- 若resistance ≈ 0：理想电流表，使用电压源(V=0)测量电流

**终端**：2个

**可视化**：圆形符号，内部"A"

**交互**：串联在电路中，显示通过电流

### Voltmeter (电压表)

**作用**：测量两端的电压差。

**属性**：
- `resistance`: 内阻 (Ω)，默认 Infinity（理想）
- `range`: 量程 (V)，默认 15V

**行为/方程**：
- 若resistance有限：普通电阻
- 若resistance = ∞：理想电压表，不贡献电路方程，仅测量

**终端**：2个

**可视化**：圆形符号，内部"V"

**交互**：并联测量电压，不影响电路

## 代理交互与电路动态

### 电路构建
- 代理通过导线连接形成节点网络
- 使用并查集算法合并电气连接点
- 电源负极通常作为参考地（节点0）

### MNA求解
- 每个代理通过"印记"贡献系数矩阵A和向量z
- 求解线性方程得到节点电压
- 计算支路电流和功率

### 动态仿真
- 时间步长dt = 0.01s
- 电容和电机涉及微分方程的数值积分
- 实时更新代理状态用于显示

## 示例

参考 `test_simple_circuit.json`：
- PowerSource提供3V电源（内阻2Ω）
- Resistor提供8Ω负载
- 串联连接形成简单电路
- 期望：电流0.3A，电阻电压2.4V

## 可扩展性

添加新代理类型：
1. 在 `ComponentDefaults` 中定义默认属性
2. 在 `ComponentNames` 中添加显示名称
3. 在 `SVGRenderer` 中实现渲染方法
4. 在 `Solver.js` 的 `stampComponent` 中添加印记逻辑
5. 更新 `Circuit.js` 的节点重建逻辑（如三端器件）

此文档为开发者和教育者提供代理行为的完整参考。</content>
<parameter name="filePath">/home/lvxiaoer/workSpace/HighSchoolCircuitSimulation/AGENTS.md